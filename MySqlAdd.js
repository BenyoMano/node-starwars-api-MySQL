 function run() {
  

  async function insertData(newResult, action) {
    try {
      console.log('Please wait...')

      let mysql = require('mysql2/promise');
      let connection = await mysql.createConnection({
          host: 'localhost',
          user: 'root',
          password: process.env.PASSWORD,
          database: 'starwars',
      });

      async function addCharacter(connection) {
        try {
          const [countCharacters] = await connection.execute(`SELECT COUNT(Ranking) FROM characters`);
          const formattedCC = countCharacters[0]['COUNT(Ranking)'];
          
          let character = `INSERT INTO characters (Name, Ranking) VALUES(?, ?)`;
          await connection.execute(character, [newResult, formattedCC + 1]);
          console.log('Added character successfully!');
        } catch (error) {
          console.error('Error executing query: ', error.message);
        }
      }

      async function addCharacterMany(connection) {
        const [countCharacters] = await connection.execute(`SELECT COUNT(Ranking) FROM characters`);
        const formattedCC = countCharacters[0]['COUNT(Ranking)'];
        
        let i = 0;
        
        for (const value of Object.values(newResult)) {
          try {
            let character = `INSERT INTO characters (Name, Ranking) VALUES(?, ?)`;
            await connection.execute(character, [newResult[i].name, formattedCC + 1 + i]);
          } catch (error) {
            console.error('Error executing query: ', error.message);
          }
          i++;
        }
      }

      if (action == 'single') {
        await addCharacter(connection);
      }

      if (action == 'multiple') {
        await addCharacterMany(connection);
        console.log('Multiple characters added!');
      }
  
      connection.end();
    
    } catch (err) {
       console.error('Error: ', err);
    }
  }
  return {
    insertData
  };

}

module.exports = run;
